

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Google Cloud &mdash; Vivarium E. coli 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=8d563738"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Continuous Integration" href="ci.html" />
    <link rel="prev" title="HPC Clusters" href="hpc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Vivarium E. coli
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="stores.html">Stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="composites.html">Composites</a></li>
<li class="toctree-l1"><a class="reference internal" href="experiments.html">Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="hpc.html">HPC Clusters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Google Cloud</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#fresh-project-setup">Fresh Project Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-your-vm">Create Your VM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-your-bucket">Create Your Bucket</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-docker-images">Build Docker Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#handling-outputs">Handling Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloud-interactive-containers">Cloud Interactive Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cloud-storage-permission-issue">Cloud Storage Permission Issue</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ci.html">Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="pycharm.html">PyCharm Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="diffs.html">Model Differences From wcEcoli</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/api_ref.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Vivarium E. coli</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Google Cloud</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/gcloud.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="google-cloud">
<h1>Google Cloud<a class="headerlink" href="#google-cloud" title="Link to this heading"></a></h1>
<p>Large vEcoli workflows can be run cost-effectively on Google Cloud. This section
covers setup starting from a fresh project, running workflows, and handling outputs.</p>
<p>Members of the Covert Lab should skip to the <a class="reference internal" href="#create-your-vm">Create Your VM</a> section for setup.</p>
<section id="fresh-project-setup">
<h2>Fresh Project Setup<a class="headerlink" href="#fresh-project-setup" title="Link to this heading"></a></h2>
<p>Create a new project for vEcoli using <a class="reference external" href="https://console.cloud.google.com/projectcreate">New project</a>.
Choose any name that you like and you should be brought to the Google Cloud
console dashboard for your new project. Use the top search bar to find
the following APIs and enable them:</p>
<ul class="simple">
<li><p>Compute Engine</p></li>
<li><p>Cloud Build</p></li>
<li><p>Artifact Registry</p></li>
</ul>
<p>You will be asked to link a billing account at this time.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you are new to Google Cloud, we recommend that you take some time to
familiarize yourself with the Cloud console after enabling the above APIs.</p>
</div>
<p>Set a default region and zone for Compute Engine following
<a class="reference external" href="https://cloud.google.com/compute/docs/regions-zones/changing-default-zone-region#console">Changing the default region or zone</a>.
This avoids unnecessary charges for multi-region data availability and access,
improves latency, and is required for some of vEcoli’s code to work.</p>
<p>Create a new repository in Artifact Registry following the steps
on <a class="reference external" href="https://cloud.google.com/artifact-registry/docs/repositories/create-repos">Create standard repositories</a>.
Make sure to name the repository <code class="docutils literal notranslate"><span class="pre">vecoli</span></code> and create it in the same
region as your Compute Engine default. This is where the Docker images
used to run the workflow will be stored (see <a class="reference internal" href="#build-docker-images">Build Docker Images</a>).</p>
<p>The Compute Engine VMs that vEcoli spawns to run workflow jobs do not
have external IP addresses (no internet access) but need access to
Google Cloud APIs. Follow the instructions on
<a class="reference external" href="https://cloud.google.com/vpc/docs/configure-private-google-access#enabling-pga">Configure Private Google Access</a>
to turn on Private Google Access for these VMs. For a fresh project, you
can click on the <code class="docutils literal notranslate"><span class="pre">default</span></code> network, then under the “Subnets”
tab, click on the subnet for your Compute Engine default region.</p>
<p>Compute Engine VMs come with <a class="reference external" href="https://cloud.google.com/compute/docs/access/service-accounts">service accounts</a>.
To run vEcoli workflows, only a small subset of the default
service account permissions are necessary. For that reason, we strongly
recommend that users either modify the default Compute Engine service
account permissions or create a dedicated vEcoli service account as follows.</p>
<p>From the <a class="reference external" href="https://console.cloud.google.com">Google Cloud console</a>,
navigate to the “IAM &amp; Admin” panel. You can edit the Compute Engine default
service account on this page by clicking the pencil icon in the corresponding row.
To create a new service account, click the “Service Accounts” tab in the side bar
and then “Create Service Account”. Once you get to a section where you
can assign roles to the service account, assign the following set of roles:</p>
<blockquote>
<div><ul class="simple">
<li><p>Artifact Registry Writer</p></li>
<li><p>Batch Agent Reporter</p></li>
<li><p>Batch Job Editor</p></li>
<li><p>Cloud Build Editor</p></li>
<li><p>Compute Instance Admin (v1)</p></li>
<li><p>Logs Writer</p></li>
<li><p>Monitoring Metric Writer</p></li>
<li><p>Service Account User</p></li>
<li><p>Storage Object Admin</p></li>
<li><p>Viewer</p></li>
</ul>
</div></blockquote>
<p>If you created a dedicated service account, keep its associated email handy
as you will need it to create your VM in the next step.</p>
</section>
<section id="create-your-vm">
<h2>Create Your VM<a class="headerlink" href="#create-your-vm" title="Link to this heading"></a></h2>
<p>Click on the terminal shell icon near the top-right corner of the
<a class="reference external" href="https://console.cloud.google.com">Cloud console</a>. Run the command
<code class="docutils literal notranslate"><span class="pre">gcloud</span> <span class="pre">init</span></code> and choose to reinitialize your configuration. Choose
the right account and project, allowing <code class="docutils literal notranslate"><span class="pre">gcloud</span></code> to pull in the
project’s default Compute Engine zone and region.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>We are using the Cloud Shell built into Cloud console for convenience.
If you would like to do this locally, you can install the <code class="docutils literal notranslate"><span class="pre">gcloud</span></code>
CLI on your machine following <a class="reference external" href="https://cloud.google.com/sdk/docs/install">these steps</a>.</p>
</div>
<p>Once done, run the following to create a Compute Engine VM to run your workflows,
replacing <code class="docutils literal notranslate"><span class="pre">INSTANCE_NAME</span></code> with a unique name of your choosing and <code class="docutils literal notranslate"><span class="pre">SERVICE_ACCT</span></code>
as described below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud<span class="w"> </span>compute<span class="w"> </span>instances<span class="w"> </span>create<span class="w"> </span>INSTANCE_NAME<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--shielded-secure-boot<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--machine-type<span class="o">=</span>e2-medium<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--scopes<span class="o">=</span>cloud-platform<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--service-account<span class="o">=</span>SERVICE_ACCT
</pre></div>
</div>
<p>If you created a new service account earlier in the setup process, substitute
the email address for that service account. If you are a member of the Covert Lab
or have been granted access to the Covert Lab project, substitute
<code class="docutils literal notranslate"><span class="pre">fireworker&#64;allen-discovery-center-mcovert.iam.gserviceaccount.com</span></code>. Otherwise,
including if you edited the default service account permissions, run
the above command without the <code class="docutils literal notranslate"><span class="pre">--service-account</span></code> flag.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Remember to stop your VM when you are done using it. You can either do this
through the Cloud console or by running <code class="docutils literal notranslate"><span class="pre">gcloud</span> <span class="pre">compute</span> <span class="pre">instances</span> <span class="pre">stop</span> <span class="pre">INSTANCE_NAME</span></code>.
You can always restart the instance when you need it again and your files will
persist across sessions.</p>
</div>
<p>SSH into your newly created VM (if connection error, wait a moment, then retry):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud<span class="w"> </span>compute<span class="w"> </span>ssh<span class="w"> </span>INSTANCE_NAME
</pre></div>
</div>
<p>Now, on the VM, initialize <code class="docutils literal notranslate"><span class="pre">gcloud</span></code> by running <code class="docutils literal notranslate"><span class="pre">gcloud</span> <span class="pre">init</span></code> and selecting the
right service account and project. Next, install Git and clone the vEcoli repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># zip and unzip necessary to install SDKMAN to get Java for nextflow</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>git<span class="w"> </span>zip<span class="w"> </span>unzip
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/CovertLab/vEcoli.git<span class="w"> </span>--filter<span class="o">=</span>blob:none
<span class="nb">cd</span><span class="w"> </span>vEcoli
</pre></div>
</div>
<p><a class="reference external" href="https://docs.astral.sh/uv/getting-started/installation/">Install uv</a>, then
create a new virtual environment and install GCSFS:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>~/.bashrc
uv<span class="w"> </span>venv
uv<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>gcsfs
</pre></div>
</div>
<p>Run the following to automatically activate the virtual environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;source ~/vEcoli/.venv/bin/activate&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
<span class="nb">source</span><span class="w"> </span>~/.bashrc
</pre></div>
</div>
<p>Finally, <a class="reference external" href="https://www.nextflow.io/docs/latest/install.html">install Nextflow</a>.</p>
</section>
<section id="create-your-bucket">
<h2>Create Your Bucket<a class="headerlink" href="#create-your-bucket" title="Link to this heading"></a></h2>
<p>vEcoli workflows persist their final outputs to a Cloud Storage
bucket. To create a bucket, follow the steps on
<a class="reference external" href="https://cloud.google.com/storage/docs/creating-buckets">this page</a>. By default,
buckets are created in the US multi-region. We strongly recommend changing this to
the same single region as your Compute Engine default (<code class="docutils literal notranslate"><span class="pre">us-west1</span></code> for Covert Lab).
All other settings can be kept as default.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Do NOT use underscores or special characters in your bucket name. Hyphens are OK.</p>
</div>
<p>Once you have created your bucket, tell vEcoli to use that bucket by setting the
<code class="docutils literal notranslate"><span class="pre">out_uri</span></code> key under the <code class="docutils literal notranslate"><span class="pre">emitter_arg</span></code> key in your config JSON (see <a class="reference internal" href="experiments.html#json-config"><span class="std std-ref">JSON Config Files</span></a>).
The URI should be in the form <code class="docutils literal notranslate"><span class="pre">gs://{bucket</span> <span class="pre">name}</span></code>. Remember to remove the <code class="docutils literal notranslate"><span class="pre">out_dir</span></code>
key under <code class="docutils literal notranslate"><span class="pre">emitter_arg</span></code> if present.</p>
</section>
<section id="build-docker-images">
<span id="docker-images"></span><h2>Build Docker Images<a class="headerlink" href="#build-docker-images" title="Link to this heading"></a></h2>
<p>On Google Cloud, each job in a workflow (ParCa, sim 1, sim 2, etc.) is run
on its own temporary VM. To ensure reproducibility, workflows run on Google
Cloud are run using Docker containers. vEcoli uses <code class="docutils literal notranslate"><span class="pre">runscripts/container/build-image.sh</span></code>
and Cloud Build to build the required Docker image from the current state
of your repository. The built images are automatically uploaded to the
<code class="docutils literal notranslate"><span class="pre">vecoli</span></code> Artifact Registry repository of your project.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you want to build Docker images for local testing, you can run
this script locally with <code class="docutils literal notranslate"><span class="pre">-l</span></code> as long as you have Docker installed.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Files that match the patterns in <code class="docutils literal notranslate"><span class="pre">.dockerignore</span></code> are excluded from the
Docker image.</p>
</div>
<p>The following configuration keys, in addition to the <code class="docutils literal notranslate"><span class="pre">out_uri</span></code> key under
<code class="docutils literal notranslate"><span class="pre">emitter_arg</span></code>, are <strong>REQUIRED</strong> to run <a class="reference internal" href="reference/api/runscripts/runscripts.workflow.html#module-runscripts.workflow" title="runscripts.workflow"><code class="xref py py-mod docutils literal notranslate"><span class="pre">runscripts.workflow</span></code></a> on
Google Cloud:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;gcloud&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1"># Boolean, whether to build a fresh Docker image. If files that are</span>
    <span class="c1"># not excluded by .dockerignore did not change since your last build,</span>
    <span class="c1"># you can set this to false to skip building the image.</span>
    <span class="s2">&quot;build_image&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="c1"># Name of Docker image to build (or use directly, if build_image is false)</span>
    <span class="s2">&quot;container_image&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After setting these options in your configuration JSON, use <code class="docutils literal notranslate"><span class="pre">screen</span></code> to open
a virtual console that will persist after your SSH connection is closed. In that
console, invoke <a class="reference internal" href="reference/api/runscripts/runscripts.workflow.html#module-runscripts.workflow" title="runscripts.workflow"><code class="xref py py-mod docutils literal notranslate"><span class="pre">runscripts.workflow</span></code></a> as normal to start a workflow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">runscripts</span><span class="o">/</span><span class="n">workflow</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">config</span> <span class="p">{}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike workflows run locally, Google Cloud workflows are run using
containers with a snapshot of the repository at the time the workflow
was launched. This means that any changes made to the repository after
launching a workflow will not be reflected in that workflow.</p>
</div>
<p>Once your workflow has started, you can use press “ctrl+a d” to detach from the
virtual console and close your SSH connection to your VM. The VM must continue
to run until the workflow is complete. You can SSH into your VM and reconnect to
the virtual terminal with <code class="docutils literal notranslate"><span class="pre">screen</span> <span class="pre">-r</span></code> to monitor progress (see <a class="reference internal" href="workflows.html#progress"><span class="std std-ref">Progress</span></a>).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>While there is no strict time limit for workflow jobs on Google Cloud, jobs
can be preempted at any time due to the use of spot VMs. Analysis scripts that
take more than a few hours to run should be excluded from workflow configurations
and manually run using <a class="reference internal" href="reference/api/runscripts/runscripts.analysis.html#module-runscripts.analysis" title="runscripts.analysis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">runscripts.analysis</span></code></a> afterwards. Alternatively, if
you are willing to pay the significant extra cost for standard VMs, delete
<code class="docutils literal notranslate"><span class="pre">google.batch.spot</span> <span class="pre">=</span> <span class="pre">true</span></code> from <code class="docutils literal notranslate"><span class="pre">runscripts/nextflow/config.template</span></code>.</p>
</div>
</section>
<section id="handling-outputs">
<h2>Handling Outputs<a class="headerlink" href="#handling-outputs" title="Link to this heading"></a></h2>
<p>Once a workflow is complete, all of the outputs should be contained within the Cloud
Storage bucket at the URI in the <code class="docutils literal notranslate"><span class="pre">out_uri</span></code> key under <code class="docutils literal notranslate"><span class="pre">emitter_arg</span></code> in the
configuration JSON. We strongly discourage users from trying to download this data,
as that will incur significant egress charges. Instead, you should use your VM to run
analyses, avoiding these charges as long as your VM and bucket are in the same region.</p>
<p>Data stored in Cloud Storage is billed for the amount of data and how long it is stored
(prorated). Storing terabytes of simulation data on Cloud Storage can cost upwards of
$1,000/year, dwarfing the cost of the compute needed to generate that data. For that
reason, we recommend that you delete workflow output data from your bucket as soon as
you are done with your analyses. If necessary, it will likely be cheaper to re-run the
workflow to regenerate that data later than to keep it around.</p>
</section>
<section id="cloud-interactive-containers">
<span id="interactive-containers"></span><h2>Cloud Interactive Containers<a class="headerlink" href="#cloud-interactive-containers" title="Link to this heading"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Install
<a class="reference external" href="https://docs.docker.com/engine/install/">Docker</a> and
<a class="reference external" href="https://cloud.google.com/storage/docs/cloud-storage-fuse/install">Google Cloud Storage FUSE</a>
on your VM before continuing. For Docker, complete
<a class="reference external" href="https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user">these additional steps</a>
to run without root privileges. Finally, add <code class="docutils literal notranslate"><span class="pre">user_allow_other</span></code> to <code class="docutils literal notranslate"><span class="pre">/etc/fuse.conf</span></code>.</p>
</div>
<p>Since all steps of the workflow are run inside Docker containers, it can be
helpful to launch an interactive instance of the container for debugging.</p>
<p>From inside your cloned repository, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>runscripts/container/interactive.sh<span class="w"> </span>-i<span class="w"> </span>container_image<span class="w"> </span>-b<span class="w"> </span>bucket
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">container_image</span></code> should be the same as in the config JSON
used to run the workflow. A copy of the config JSON should be saved to the Cloud
Storage bucket with the other output for reference (see <a class="reference internal" href="workflows.html#id9"><span class="std std-ref">Output</span></a>).
<code class="docutils literal notranslate"><span class="pre">bucket</span></code> should be the output Cloud Storage bucket (<code class="docutils literal notranslate"><span class="pre">out_uri</span></code> in config JSON).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Inside the interactive container, you can safely use <code class="docutils literal notranslate"><span class="pre">python</span></code> directly
in addition to the usual <code class="docutils literal notranslate"><span class="pre">uv</span></code> commands.</p>
</div>
<p>Inside the container, navigate to <code class="docutils literal notranslate"><span class="pre">/vEcoli</span></code> and add breakpoints as you see fit.
Note the working directory (see <a class="reference internal" href="workflows.html#troubleshooting"><span class="std std-ref">Troubleshooting</span></a>) of the Nextflow task you
want to debug (should be of the form <code class="docutils literal notranslate"><span class="pre">/mnt/disks/{bucket}/...</span></code>). <strong>OUTSIDE</strong>
the working directory, run the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Symlink files, including the script for the task (.command.sh)</span>
bash<span class="w"> </span><span class="o">{</span>working<span class="w"> </span>directory<span class="o">}</span>/.command.run<span class="w"> </span>nxf_stage
<span class="c1"># Now enter working directory</span>
<span class="nb">cd</span><span class="w"> </span><span class="o">{</span>working<span class="w"> </span>directory<span class="o">}</span>
<span class="c1"># Run the task, pausing at breakpoints</span>
bash<span class="w"> </span>.command.sh
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Any changes that you make to <code class="docutils literal notranslate"><span class="pre">/vEcoli</span></code> inside the container are discarded
when the container terminates.</p>
</div>
<p>The files located in <code class="docutils literal notranslate"><span class="pre">/vEcoli</span></code> are a copy of your cloned repository (excluding
files ignored by <code class="docutils literal notranslate"><span class="pre">.dockerignore</span></code>) at the time the workflow was launched.
To start an interactive container that reflects the current state of your
cloned repository, add the <code class="docutils literal notranslate"><span class="pre">-d</span></code> flag to start a “development” container
(see second half of <a class="reference internal" href="hpc.html#sherlock-interactive"><span class="std std-ref">Interactive Container</span></a>).</p>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h2>
<section id="cloud-storage-permission-issue">
<h3>Cloud Storage Permission Issue<a class="headerlink" href="#cloud-storage-permission-issue" title="Link to this heading"></a></h3>
<p>If you are trying to launch a cloud workflow or access cloud
output (e.g. run an analysis script) from a local computer, you
may encounter an error like the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>HttpError:<span class="w"> </span>Anonymous<span class="w"> </span><span class="nb">caller</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>have<span class="w"> </span>storage.objects.list<span class="w"> </span>access<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>Google<span class="w"> </span>Cloud<span class="w"> </span>Storage<span class="w"> </span>bucket.<span class="w"> </span>Permission<span class="w"> </span><span class="s1">&#39;storage.objects.list&#39;</span><span class="w"> </span>denied<span class="w"> </span>on<span class="w"> </span>resource<span class="w"> </span><span class="o">(</span>or<span class="w"> </span>it<span class="w"> </span>may<span class="w"> </span>not<span class="w"> </span>exist<span class="o">)</span>.,<span class="w"> </span><span class="m">401</span>
</pre></div>
</div>
<p>We do not recommend using local computers to launch
cloud workflows because that would require the computer to be on and connected
to the internet for the entire duration of the workflow. We STRONGLY discourage
the use of a local computer to run analyses on workflow output saved in
Cloud Storage as that will incur hefty data egress charges.</p>
<p>Instead, users should stick to launching workflows and running analysis scripts
on Compute Engine VMs. Small VMs are fairly cheap to keep running for the duration
of a workflow, and larger VMs can be created to leverage DuckDB’s multithreading
for fast reading of workflow outputs stored in Cloud Storage. Assuming the VMs are
in the same region as the Cloud Storage bucket being accessed, no egress charges
will be applied, resulting in much lower costs.</p>
<p>If you absolutely must interact with cloud resources from a local machine, the above
error may be resolved by running the following command to generate credentials that
will be automatically picked up by GCSFS:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud<span class="w"> </span>auth<span class="w"> </span>application-default<span class="w"> </span>login
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="hpc.html" class="btn btn-neutral float-left" title="HPC Clusters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ci.html" class="btn btn-neutral float-right" title="Continuous Integration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2026, The Vivarium E. coli Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
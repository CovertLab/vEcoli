

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ecoli.processes.rna_degradation &mdash; Vivarium E. coli 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Vivarium E. coli
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../stores.html">Stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../composites.html">Composites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../experiments.html">Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hpc.html">HPC Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gcloud.html">Google Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ci.html">Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pycharm.html">PyCharm Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/api_ref.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Vivarium E. coli</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">ecoli.processes.rna_degradation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ecoli.processes.rna_degradation</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">===============</span>
<span class="sd">RNA Degradation</span>
<span class="sd">===============</span>

<span class="sd">Mathematical formulations</span>

<span class="sd">* ``dr/dt = Kb - kcatEndoRNase * EndoRNase * r/Km / (1 + Sum(r/Km))``</span>

<span class="sd">where</span>

<span class="sd">* r = RNA counts</span>
<span class="sd">* Kb = RNA production given a RNAP synthesis rate</span>
<span class="sd">* kcatEndoRNase = enzymatic activity for EndoRNases</span>
<span class="sd">* Km = Michaelis-Menten constants fitted to recapitulate first-order</span>
<span class="sd">* RNA decay: ``kd * r = kcatEndoRNase * EndoRNase * r/Km / (1 + sum(r/Km))``</span>

<span class="sd">This sub-model encodes molecular simulation of RNA degradation as two main</span>
<span class="sd">steps guided by RNases, &quot;endonucleolytic cleavage&quot; and &quot;exonucleolytic</span>
<span class="sd">digestion&quot;:</span>

<span class="sd">1. Compute total counts of RNA to be degraded (D) and total capacity for</span>
<span class="sd">   endo-cleavage (C) at each time point</span>
<span class="sd">2. Evaluate C and D. If C &gt; D, then define a fraction of active endoRNases</span>
<span class="sd">3. Dissect RNA degraded into different species (mRNA, tRNA, and rRNA) by</span>
<span class="sd">   accounting endoRNases specificity</span>
<span class="sd">4. Update RNA fragments (assumption: fragments are represented as a pool of</span>
<span class="sd">   nucleotides) created because of endonucleolytic cleavage</span>
<span class="sd">5. Compute total capacity of exoRNases and determine fraction of nucleotides</span>
<span class="sd">   that can be digested</span>
<span class="sd">6. Update pool of metabolites (H and H2O) created because of exonucleolytic</span>
<span class="sd">   digestion</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">ecoli.library.schema</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">bulk_name_to_idx</span><span class="p">,</span>
    <span class="n">counts</span><span class="p">,</span>
    <span class="n">attrs</span><span class="p">,</span>
    <span class="n">numpy_schema</span><span class="p">,</span>
    <span class="n">listener_schema</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">wholecell.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">units</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">ecoli.processes.registries</span><span class="w"> </span><span class="kn">import</span> <span class="n">topology_registry</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ecoli.processes.partition</span><span class="w"> </span><span class="kn">import</span> <span class="n">PartitionedProcess</span>


<span class="c1"># Register default topology for this process, associating it with process name</span>
<span class="n">NAME</span> <span class="o">=</span> <span class="s2">&quot;ecoli-rna-degradation&quot;</span>
<span class="n">TOPOLOGY</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;bulk&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;bulk&quot;</span><span class="p">,),</span>
    <span class="s2">&quot;RNAs&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;unique&quot;</span><span class="p">,</span> <span class="s2">&quot;RNA&quot;</span><span class="p">),</span>
    <span class="s2">&quot;active_ribosome&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;unique&quot;</span><span class="p">,</span> <span class="s2">&quot;active_ribosome&quot;</span><span class="p">),</span>
    <span class="s2">&quot;listeners&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;listeners&quot;</span><span class="p">,),</span>
    <span class="s2">&quot;timestep&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;timestep&quot;</span><span class="p">,),</span>
<span class="p">}</span>
<span class="n">topology_registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">TOPOLOGY</span><span class="p">)</span>


<div class="viewcode-block" id="RnaDegradation">
<a class="viewcode-back" href="../../../reference/api/ecoli/ecoli.processes.rna_degradation.html#ecoli.processes.rna_degradation.RnaDegradation">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RnaDegradation</span><span class="p">(</span><span class="n">PartitionedProcess</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;RNA Degradation PartitionedProcess&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">NAME</span>
    <span class="n">topology</span> <span class="o">=</span> <span class="n">TOPOLOGY</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;rna_ids&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;mature_rna_ids&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;cistron_ids&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;cistron_tu_mapping_matrix&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;mature_rna_cistron_indexes&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;all_rna_ids&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;n_total_RNAs&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;n_avogadro&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s2">&quot;cell_density&quot;</span><span class="p">:</span> <span class="mi">1100</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">g</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">L</span><span class="p">,</span>
        <span class="s2">&quot;endoRNase_ids&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;exoRNase_ids&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;kcat_exoRNase&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
        <span class="s2">&quot;Kcat_endoRNases&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
        <span class="s2">&quot;charged_trna_names&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;uncharged_trna_indexes&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;rna_deg_rates&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;is_mRNA&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
        <span class="s2">&quot;is_rRNA&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
        <span class="s2">&quot;is_tRNA&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
        <span class="s2">&quot;is_miscRNA&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
        <span class="s2">&quot;degrade_misc&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;rna_lengths&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
        <span class="s2">&quot;nt_counts&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[]]),</span>
        <span class="s2">&quot;polymerized_ntp_ids&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;water_id&quot;</span><span class="p">:</span> <span class="s2">&quot;h2o&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ppi_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ppi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;proton_id&quot;</span><span class="p">:</span> <span class="s2">&quot;h+&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nmp_ids&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;rrfa_idx&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;rrla_idx&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;rrsa_idx&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;ribosome30S&quot;</span><span class="p">:</span> <span class="s2">&quot;ribosome30S&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ribosome50S&quot;</span><span class="p">:</span> <span class="s2">&quot;ribosome50S&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Kms&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mol</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">L</span><span class="p">,</span>
        <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;emit_unique&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rna_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;rna_ids&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mature_rna_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;mature_rna_ids&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_transcribed_rnas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rna_ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mature_rna_exists</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mature_rna_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cistron_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;cistron_ids&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cistron_tu_mapping_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;cistron_tu_mapping_matrix&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mature_rna_cistron_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;mature_rna_cistron_indexes&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_rna_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;all_rna_ids&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_total_RNAs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;n_total_RNAs&quot;</span><span class="p">]</span>

        <span class="c1"># Load constants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_avogadro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;n_avogadro&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;cell_density&quot;</span><span class="p">]</span>

        <span class="c1"># Load RNase kinetic data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endoRNase_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;endoRNase_ids&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exoRNase_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;exoRNase_ids&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kcat_exoRNase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;kcat_exoRNase&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Kcat_endoRNases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;Kcat_endoRNases&quot;</span><span class="p">]</span>

        <span class="c1"># Load information about uncharged/charged tRNA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uncharged_trna_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;uncharged_trna_indexes&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charged_trna_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;charged_trna_names&quot;</span><span class="p">]</span>

        <span class="c1"># Load first-order RNA degradation rates</span>
        <span class="c1"># (estimated by mRNA half-life data)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rna_deg_rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;rna_deg_rates&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_mRNA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;is_mRNA&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_rRNA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;is_rRNA&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_tRNA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;is_tRNA&quot;</span><span class="p">]</span>

        <span class="c1"># NEW to vivarium-ecoli</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_miscRNA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;is_miscRNA&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">degrade_misc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;degrade_misc&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rna_lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;rna_lengths&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nt_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;nt_counts&quot;</span><span class="p">]</span>

        <span class="c1"># Build stoichiometric matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polymerized_ntp_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;polymerized_ntp_ids&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nmp_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;nmp_ids&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">water_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;water_id&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ppi_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ppi_id&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proton_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;proton_id&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end_cleavage_metabolite_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polymerized_ntp_ids</span> <span class="o">+</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">water_id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ppi_id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proton_id</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">nmp_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">water_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_cleavage_metabolite_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">water_id</span><span class="p">)</span>
        <span class="n">ppi_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_cleavage_metabolite_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ppi_id</span><span class="p">)</span>
        <span class="n">proton_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_cleavage_metabolite_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proton_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endo_degradation_stoich_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_cleavage_metabolite_ids</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_total_RNAs</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endo_degradation_stoich_matrix</span><span class="p">[</span><span class="n">nmp_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nt_counts</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endo_degradation_stoich_matrix</span><span class="p">[</span><span class="n">water_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endo_degradation_stoich_matrix</span><span class="p">[</span><span class="n">ppi_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endo_degradation_stoich_matrix</span><span class="p">[</span><span class="n">proton_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Load Michaelis-Menten constants fitted to recapitulate</span>
        <span class="c1"># first-order RNA decay model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Kms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;Kms&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>

        <span class="c1"># Numpy indices for bulk molecules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">water_idx</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="RnaDegradation.ports_schema">
<a class="viewcode-back" href="../../../reference/api/ecoli/ecoli.processes.rna_degradation.html#ecoli.processes.rna_degradation.RnaDegradation.ports_schema">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ports_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;bulk&quot;</span><span class="p">:</span> <span class="n">numpy_schema</span><span class="p">(</span><span class="s2">&quot;bulk&quot;</span><span class="p">),</span>
            <span class="s2">&quot;active_ribosome&quot;</span><span class="p">:</span> <span class="n">numpy_schema</span><span class="p">(</span>
                <span class="s2">&quot;active_ribosome&quot;</span><span class="p">,</span> <span class="n">emit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;emit_unique&quot;</span><span class="p">]</span>
            <span class="p">),</span>
            <span class="s2">&quot;RNAs&quot;</span><span class="p">:</span> <span class="n">numpy_schema</span><span class="p">(</span><span class="s2">&quot;RNAs&quot;</span><span class="p">,</span> <span class="n">emit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;emit_unique&quot;</span><span class="p">]),</span>
            <span class="s2">&quot;listeners&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="n">listener_schema</span><span class="p">({</span><span class="s2">&quot;cell_mass&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;dry_mass&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}),</span>
                <span class="s2">&quot;rna_degradation_listener&quot;</span><span class="p">:</span> <span class="n">listener_schema</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;fraction_active_endornases&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                        <span class="s2">&quot;diff_relative_first_order_decay&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                        <span class="s2">&quot;fract_endo_rrna_counts&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                        <span class="s2">&quot;count_rna_degraded&quot;</span><span class="p">:</span> <span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_rna_ids</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">all_rna_ids</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="s2">&quot;count_RNA_degraded_per_cistron&quot;</span><span class="p">:</span> <span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cistron_ids</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cistron_ids</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="s2">&quot;nucleotides_from_degradation&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="s2">&quot;fragment_bases_digested&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">),</span>
            <span class="p">},</span>
            <span class="s2">&quot;timestep&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;_default&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;time_step&quot;</span><span class="p">]},</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="RnaDegradation.calculate_request">
<a class="viewcode-back" href="../../../reference/api/ecoli/ecoli.processes.rna_degradation.html#ecoli.processes.rna_degradation.RnaDegradation.calculate_request">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">states</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">water_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bulk_ids</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="s2">&quot;bulk&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charged_trna_idx</span> <span class="o">=</span> <span class="n">bulk_name_to_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charged_trna_names</span><span class="p">,</span> <span class="n">bulk_ids</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bulk_rnas_idx</span> <span class="o">=</span> <span class="n">bulk_name_to_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_rna_ids</span><span class="p">,</span> <span class="n">bulk_ids</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nmps_idx</span> <span class="o">=</span> <span class="n">bulk_name_to_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nmp_ids</span><span class="p">,</span> <span class="n">bulk_ids</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fragment_metabolites_idx</span> <span class="o">=</span> <span class="n">bulk_name_to_idx</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">end_cleavage_metabolite_ids</span><span class="p">,</span> <span class="n">bulk_ids</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fragment_bases_idx</span> <span class="o">=</span> <span class="n">bulk_name_to_idx</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">polymerized_ntp_ids</span><span class="p">,</span> <span class="n">bulk_ids</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">endoRNase_idx</span> <span class="o">=</span> <span class="n">bulk_name_to_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endoRNase_ids</span><span class="p">,</span> <span class="n">bulk_ids</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exoRNase_idx</span> <span class="o">=</span> <span class="n">bulk_name_to_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exoRNase_ids</span><span class="p">,</span> <span class="n">bulk_ids</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">water_idx</span> <span class="o">=</span> <span class="n">bulk_name_to_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">water_id</span><span class="p">,</span> <span class="n">bulk_ids</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proton_idx</span> <span class="o">=</span> <span class="n">bulk_name_to_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proton_id</span><span class="p">,</span> <span class="n">bulk_ids</span><span class="p">)</span>

        <span class="c1"># Compute factor that convert counts into concentration, and vice versa</span>
        <span class="n">cell_mass</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="s2">&quot;listeners&quot;</span><span class="p">][</span><span class="s2">&quot;mass&quot;</span><span class="p">][</span><span class="s2">&quot;cell_mass&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">fg</span>
        <span class="n">cell_volume</span> <span class="o">=</span> <span class="n">cell_mass</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_density</span>
        <span class="n">counts_to_molar</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_avogadro</span> <span class="o">*</span> <span class="n">cell_volume</span><span class="p">)</span>

        <span class="c1"># Get total counts of RNAs including free rRNAs, uncharged and charged tRNAs, and</span>
        <span class="c1"># active (translatable) unique mRNAs</span>
        <span class="n">bulk_RNA_counts</span> <span class="o">=</span> <span class="n">counts</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="s2">&quot;bulk&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_rnas_idx</span><span class="p">)</span>
        <span class="n">bulk_RNA_counts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uncharged_trna_indexes</span><span class="p">]</span> <span class="o">+=</span> <span class="n">counts</span><span class="p">(</span>
            <span class="n">states</span><span class="p">[</span><span class="s2">&quot;bulk&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">charged_trna_idx</span>
        <span class="p">)</span>

        <span class="n">TU_index</span><span class="p">,</span> <span class="n">can_translate</span><span class="p">,</span> <span class="n">is_full_transcript</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">(</span>
            <span class="n">states</span><span class="p">[</span><span class="s2">&quot;RNAs&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;TU_index&quot;</span><span class="p">,</span> <span class="s2">&quot;can_translate&quot;</span><span class="p">,</span> <span class="s2">&quot;is_full_transcript&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">TU_index_translatable_mRNAs</span> <span class="o">=</span> <span class="n">TU_index</span><span class="p">[</span><span class="n">can_translate</span><span class="p">]</span>
        <span class="n">unique_RNA_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span>
            <span class="n">TU_index_translatable_mRNAs</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_total_RNAs</span>
        <span class="p">)</span>
        <span class="n">total_RNA_counts</span> <span class="o">=</span> <span class="n">bulk_RNA_counts</span> <span class="o">+</span> <span class="n">unique_RNA_counts</span>

        <span class="c1"># Compute RNA concentrations</span>
        <span class="n">rna_conc_molar</span> <span class="o">=</span> <span class="n">counts_to_molar</span> <span class="o">*</span> <span class="n">total_RNA_counts</span>

        <span class="c1"># Get counts of endoRNases</span>
        <span class="n">endoRNase_counts</span> <span class="o">=</span> <span class="n">counts</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="s2">&quot;bulk&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">endoRNase_idx</span><span class="p">)</span>
        <span class="n">total_kcat_endoRNase</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Kcat_endoRNases</span><span class="p">,</span> <span class="n">endoRNase_counts</span><span class="p">)</span>

        <span class="c1"># Calculate the fraction of active endoRNases for each RNA based on</span>
        <span class="c1"># Michaelis-Menten kinetics</span>
        <span class="n">frac_endoRNase_saturated</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">rna_conc_molar</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kms</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">units</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rna_conc_molar</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kms</span><span class="p">))</span>
        <span class="p">)</span><span class="o">.</span><span class="n">asNumber</span><span class="p">()</span>

        <span class="c1"># Calculate difference in degradation rates from first-order decay</span>
        <span class="c1"># and the number of EndoRNases per one molecule of RNA</span>
        <span class="n">total_endoRNase_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">endoRNase_counts</span><span class="p">)</span>
        <span class="n">diff_relative_first_order_decay</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">units</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rna_deg_rates</span> <span class="o">*</span> <span class="n">total_RNA_counts</span>
                <span class="o">-</span> <span class="n">total_kcat_endoRNase</span> <span class="o">*</span> <span class="n">frac_endoRNase_saturated</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">endoRNase_per_rna</span> <span class="o">=</span> <span class="n">total_endoRNase_counts</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">total_RNA_counts</span><span class="p">)</span>

        <span class="n">requests</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;listeners&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;rna_degradation_listener&quot;</span><span class="p">:</span> <span class="p">{}}}</span>
        <span class="n">requests</span><span class="p">[</span><span class="s2">&quot;listeners&quot;</span><span class="p">][</span><span class="s2">&quot;rna_degradation_listener&quot;</span><span class="p">][</span>
            <span class="s2">&quot;fraction_active_endoRNases&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">frac_endoRNase_saturated</span><span class="p">)</span>
        <span class="n">requests</span><span class="p">[</span><span class="s2">&quot;listeners&quot;</span><span class="p">][</span><span class="s2">&quot;rna_degradation_listener&quot;</span><span class="p">][</span>
            <span class="s2">&quot;diff_relative_first_order_decay&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">diff_relative_first_order_decay</span><span class="o">.</span><span class="n">asNumber</span><span class="p">()</span>
        <span class="n">requests</span><span class="p">[</span><span class="s2">&quot;listeners&quot;</span><span class="p">][</span><span class="s2">&quot;rna_degradation_listener&quot;</span><span class="p">][</span><span class="s2">&quot;fract_endo_rrna_counts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">endoRNase_per_rna</span>
        <span class="p">)</span>

        <span class="c1"># Dissect RNAse specificity into mRNA, tRNA, and rRNA</span>
        <span class="c1"># NEW to vivarium-ecoli: Degrade miscRNAs and mRNAs together</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degrade_misc</span><span class="p">:</span>
            <span class="n">is_transient_rna</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mRNA</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_miscRNA</span>
            <span class="n">mrna_specificity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">frac_endoRNase_saturated</span><span class="p">,</span> <span class="n">is_transient_rna</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mrna_specificity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">frac_endoRNase_saturated</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mRNA</span><span class="p">)</span>
        <span class="n">trna_specificity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">frac_endoRNase_saturated</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_tRNA</span><span class="p">)</span>
        <span class="n">rrna_specificity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">frac_endoRNase_saturated</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rRNA</span><span class="p">)</span>

        <span class="n">n_total_mrnas_to_degrade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_total_n_to_degrade</span><span class="p">(</span>
            <span class="n">states</span><span class="p">[</span><span class="s2">&quot;timestep&quot;</span><span class="p">],</span> <span class="n">mrna_specificity</span><span class="p">,</span> <span class="n">total_kcat_endoRNase</span>
        <span class="p">)</span>
        <span class="n">n_total_trnas_to_degrade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_total_n_to_degrade</span><span class="p">(</span>
            <span class="n">states</span><span class="p">[</span><span class="s2">&quot;timestep&quot;</span><span class="p">],</span> <span class="n">trna_specificity</span><span class="p">,</span> <span class="n">total_kcat_endoRNase</span>
        <span class="p">)</span>
        <span class="n">n_total_rrnas_to_degrade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_total_n_to_degrade</span><span class="p">(</span>
            <span class="n">states</span><span class="p">[</span><span class="s2">&quot;timestep&quot;</span><span class="p">],</span> <span class="n">rrna_specificity</span><span class="p">,</span> <span class="n">total_kcat_endoRNase</span>
        <span class="p">)</span>

        <span class="c1"># Compute RNAse specificity</span>
        <span class="n">rna_specificity</span> <span class="o">=</span> <span class="n">frac_endoRNase_saturated</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">frac_endoRNase_saturated</span><span class="p">)</span>

        <span class="c1"># Boolean variable that tracks existence of each RNA</span>
        <span class="n">rna_exists</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_RNA_counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

        <span class="c1"># Compute degradation probabilities of each RNA: for mRNAs and rRNAs, this</span>
        <span class="c1"># is based on the specificity of each mRNA. For tRNAs and rRNAs,</span>
        <span class="c1"># this is distributed evenly.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degrade_misc</span><span class="p">:</span>
            <span class="n">mrna_deg_probs</span> <span class="o">=</span> <span class="p">(</span>
                <span class="mf">1.0</span>
                <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rna_specificity</span><span class="p">,</span> <span class="n">is_transient_rna</span> <span class="o">*</span> <span class="n">rna_exists</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">rna_specificity</span>
                <span class="o">*</span> <span class="n">is_transient_rna</span>
                <span class="o">*</span> <span class="n">rna_exists</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mrna_deg_probs</span> <span class="o">=</span> <span class="p">(</span>
                <span class="mf">1.0</span>
                <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rna_specificity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mRNA</span> <span class="o">*</span> <span class="n">rna_exists</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">rna_specificity</span>
                <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mRNA</span>
                <span class="o">*</span> <span class="n">rna_exists</span>
            <span class="p">)</span>
        <span class="n">rrna_deg_probs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">1.0</span>
            <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rna_specificity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rRNA</span> <span class="o">*</span> <span class="n">rna_exists</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">rna_specificity</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rRNA</span>
            <span class="o">*</span> <span class="n">rna_exists</span>
        <span class="p">)</span>
        <span class="n">trna_deg_probs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_tRNA</span><span class="p">,</span> <span class="n">rna_exists</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_tRNA</span> <span class="o">*</span> <span class="n">rna_exists</span>
        <span class="p">)</span>

        <span class="c1"># Mask RNA counts into each class of RNAs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degrade_misc</span><span class="p">:</span>
            <span class="n">mrna_counts</span> <span class="o">=</span> <span class="n">total_RNA_counts</span> <span class="o">*</span> <span class="n">is_transient_rna</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mrna_counts</span> <span class="o">=</span> <span class="n">total_RNA_counts</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mRNA</span>
        <span class="n">trna_counts</span> <span class="o">=</span> <span class="n">total_RNA_counts</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_tRNA</span>
        <span class="n">rrna_counts</span> <span class="o">=</span> <span class="n">total_RNA_counts</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rRNA</span>

        <span class="c1"># Determine number of individual RNAs to be degraded for each class</span>
        <span class="c1"># of RNA.</span>
        <span class="n">n_mrnas_to_degrade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_rnas_to_degrade</span><span class="p">(</span>
            <span class="n">n_total_mrnas_to_degrade</span><span class="p">,</span> <span class="n">mrna_deg_probs</span><span class="p">,</span> <span class="n">mrna_counts</span>
        <span class="p">)</span>
        <span class="n">n_trnas_to_degrade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_rnas_to_degrade</span><span class="p">(</span>
            <span class="n">n_total_trnas_to_degrade</span><span class="p">,</span> <span class="n">trna_deg_probs</span><span class="p">,</span> <span class="n">trna_counts</span>
        <span class="p">)</span>
        <span class="n">n_rrnas_to_degrade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_rnas_to_degrade</span><span class="p">(</span>
            <span class="n">n_total_rrnas_to_degrade</span><span class="p">,</span> <span class="n">rrna_deg_probs</span><span class="p">,</span> <span class="n">rrna_counts</span>
        <span class="p">)</span>
        <span class="n">n_RNAs_to_degrade</span> <span class="o">=</span> <span class="n">n_mrnas_to_degrade</span> <span class="o">+</span> <span class="n">n_trnas_to_degrade</span> <span class="o">+</span> <span class="n">n_rrnas_to_degrade</span>

        <span class="c1"># Bulk RNAs (tRNAs and rRNAs) are degraded immediately. Unique RNAs</span>
        <span class="c1"># (mRNAs) are immediately deactivated (becomes unable to bind</span>
        <span class="c1"># ribosomes), but not degraded until transcription is finished and the</span>
        <span class="c1"># mRNA becomes a full transcript to simplify the transcript elongation</span>
        <span class="c1"># process.</span>
        <span class="n">n_bulk_RNAs_to_degrade</span> <span class="o">=</span> <span class="n">n_RNAs_to_degrade</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">n_bulk_RNAs_to_degrade</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">is_mRNA</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_unique_RNAs_to_deactivate</span> <span class="o">=</span> <span class="n">n_RNAs_to_degrade</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_unique_RNAs_to_deactivate</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_mRNA</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">requests</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;bulk&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_rnas_idx</span><span class="p">,</span> <span class="n">n_bulk_RNAs_to_degrade</span><span class="p">),</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fragment_bases_idx</span><span class="p">,</span>
                    <span class="n">counts</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="s2">&quot;bulk&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_bases_idx</span><span class="p">),</span>
                <span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Calculate the amount of water required for total RNA hydrolysis by</span>
        <span class="c1"># endo and exonucleases. We first calculate the number of unique RNAs</span>
        <span class="c1"># that should be degraded at this timestep.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unique_mRNAs_to_degrade</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">can_translate</span><span class="p">),</span> <span class="n">is_full_transcript</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_unique_RNAs_to_degrade</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span>
            <span class="n">TU_index</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_mRNAs_to_degrade</span><span class="p">],</span> <span class="n">minlength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_total_RNAs</span>
        <span class="p">)</span>

        <span class="c1"># Assuming complete hydrolysis for now. Note that one additional water</span>
        <span class="c1"># molecule is needed for each RNA to hydrolyze the 5&#39; diphosphate.</span>
        <span class="n">water_for_degraded_rnas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
            <span class="n">n_bulk_RNAs_to_degrade</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_unique_RNAs_to_degrade</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rna_lengths</span>
        <span class="p">)</span>
        <span class="n">water_for_fragments</span> <span class="o">=</span> <span class="n">counts</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="s2">&quot;bulk&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fragment_bases_idx</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">requests</span><span class="p">[</span><span class="s2">&quot;bulk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">water_idx</span><span class="p">,</span> <span class="n">water_for_degraded_rnas</span> <span class="o">+</span> <span class="n">water_for_fragments</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">requests</span></div>


<div class="viewcode-block" id="RnaDegradation.evolve_state">
<a class="viewcode-back" href="../../../reference/api/ecoli/ecoli.processes.rna_degradation.html#ecoli.processes.rna_degradation.RnaDegradation.evolve_state">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">evolve_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">states</span><span class="p">):</span>
        <span class="c1"># Get vector of numbers of RNAs to degrade for each RNA species</span>
        <span class="n">n_degraded_bulk_RNA</span> <span class="o">=</span> <span class="n">counts</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="s2">&quot;bulk&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_rnas_idx</span><span class="p">)</span>
        <span class="n">n_degraded_unique_RNA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_unique_RNAs_to_degrade</span>
        <span class="n">n_degraded_RNA</span> <span class="o">=</span> <span class="n">n_degraded_bulk_RNA</span> <span class="o">+</span> <span class="n">n_degraded_unique_RNA</span>

        <span class="c1"># Deactivate and degrade unique RNAs</span>
        <span class="n">TU_index</span><span class="p">,</span> <span class="n">can_translate</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="s2">&quot;RNAs&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;TU_index&quot;</span><span class="p">,</span> <span class="s2">&quot;can_translate&quot;</span><span class="p">])</span>
        <span class="n">can_translate</span> <span class="o">=</span> <span class="n">can_translate</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">n_deactivated_unique_RNA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_unique_RNAs_to_deactivate</span>

        <span class="c1"># Deactive unique RNAs</span>
        <span class="n">non_zero_deactivation</span> <span class="o">=</span> <span class="n">n_deactivated_unique_RNA</span> <span class="o">&gt;</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">n_degraded</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_deactivated_unique_RNA</span><span class="o">.</span><span class="n">size</span><span class="p">)[</span><span class="n">non_zero_deactivation</span><span class="p">],</span>
            <span class="n">n_deactivated_unique_RNA</span><span class="p">[</span><span class="n">non_zero_deactivation</span><span class="p">],</span>
        <span class="p">):</span>
            <span class="c1"># Get mask for translatable mRNAs belonging to the degraded species</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">TU_index</span> <span class="o">==</span> <span class="n">index</span><span class="p">,</span> <span class="n">can_translate</span><span class="p">)</span>

            <span class="c1"># Choose n_degraded indexes randomly to deactivate</span>
            <span class="n">can_translate</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
                    <span class="n">size</span><span class="o">=</span><span class="n">n_degraded</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
            <span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">count_RNA_degraded_per_cistron</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cistron_tu_mapping_matrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
            <span class="n">n_degraded_RNA</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_transcribed_rnas</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># Add degraded counts from mature RNAs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mature_rna_exists</span><span class="p">:</span>
            <span class="n">count_RNA_degraded_per_cistron</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mature_rna_cistron_indexes</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="n">n_degraded_RNA</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transcribed_rnas</span> <span class="p">:]</span>
            <span class="p">)</span>

        <span class="n">update</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;listeners&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;rna_degradation_listener&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;count_rna_degraded&quot;</span><span class="p">:</span> <span class="n">n_degraded_RNA</span><span class="p">,</span>
                    <span class="s2">&quot;nucleotides_from_degradation&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
                        <span class="n">n_degraded_RNA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rna_lengths</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;count_RNA_degraded_per_cistron&quot;</span><span class="p">:</span> <span class="n">count_RNA_degraded_per_cistron</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="c1"># Degrade bulk RNAs</span>
            <span class="s2">&quot;bulk&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_rnas_idx</span><span class="p">,</span> <span class="o">-</span><span class="n">n_degraded_bulk_RNA</span><span class="p">)],</span>
            <span class="s2">&quot;RNAs&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;can_translate&quot;</span><span class="p">:</span> <span class="n">can_translate</span><span class="p">},</span>
                <span class="c1"># Degrade full mRNAs that are inactive</span>
                <span class="s2">&quot;delete&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_mRNAs_to_degrade</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">},</span>
        <span class="p">}</span>

        <span class="c1"># Modeling assumption: Once a RNA is cleaved by an endonuclease its</span>
        <span class="c1"># resulting nucleotides are lumped together as &quot;polymerized fragments&quot;.</span>
        <span class="c1"># These fragments can carry over from previous timesteps. We are also</span>
        <span class="c1"># assuming that during endonucleolytic cleavage the 5&#39;terminal</span>
        <span class="c1"># phosphate is removed. This is modeled as all of the fragments being</span>
        <span class="c1"># one long linear chain of &quot;fragment bases&quot;.</span>

        <span class="c1"># Example:</span>
        <span class="c1"># PPi-Base-PO4(-)-Base-PO4(-)-Base-OH</span>
        <span class="c1"># ==&gt;</span>
        <span class="c1"># Pi-FragmentBase-PO4(-)-FragmentBase-PO4(-)-FragmentBase + PPi</span>
        <span class="c1"># Note: Lack of -OH on 3&#39; end of chain</span>
        <span class="n">metabolites_endo_cleavage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">endo_degradation_stoich_matrix</span><span class="p">,</span> <span class="n">n_degraded_RNA</span>
        <span class="p">)</span>

        <span class="c1"># Increase polymerized fragment counts</span>
        <span class="n">update</span><span class="p">[</span><span class="s2">&quot;bulk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fragment_metabolites_idx</span><span class="p">,</span> <span class="n">metabolites_endo_cleavage</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># fragment_metabolites overlaps with fragment_bases</span>
        <span class="n">bulk_count_copy</span> <span class="o">=</span> <span class="n">states</span><span class="p">[</span><span class="s2">&quot;bulk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bulk_count_copy</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">bulk_count_copy</span> <span class="o">=</span> <span class="n">bulk_count_copy</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
        <span class="n">bulk_count_copy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fragment_metabolites_idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">metabolites_endo_cleavage</span>
        <span class="n">fragment_bases</span> <span class="o">=</span> <span class="n">bulk_count_copy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fragment_bases_idx</span><span class="p">]</span>

        <span class="c1"># Check if exonucleolytic digestion can happen</span>
        <span class="k">if</span> <span class="n">fragment_bases</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">update</span>

        <span class="c1"># Calculate exolytic cleavage events</span>

        <span class="c1"># Modeling assumption: We model fragments as one long fragment chain of</span>
        <span class="c1"># polymerized nucleotides. We are also assuming that there is no</span>
        <span class="c1"># sequence specificity or bias towards which nucleotides are</span>
        <span class="c1"># hydrolyzed.</span>

        <span class="c1"># Example:</span>
        <span class="c1"># Pi-FragmentBase-PO4(-)-FragmentBase-PO4(-)-FragmentBase + 3 H2O</span>
        <span class="c1"># ==&gt;</span>
        <span class="c1"># 3 NMP + 3 H(+)</span>
        <span class="c1"># Note: Lack of -OH on 3&#39; end of chain</span>

        <span class="n">n_exoRNases</span> <span class="o">=</span> <span class="n">counts</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="s2">&quot;bulk&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">exoRNase_idx</span><span class="p">)</span>
        <span class="n">n_fragment_bases</span> <span class="o">=</span> <span class="n">fragment_bases</span>
        <span class="n">n_fragment_bases_sum</span> <span class="o">=</span> <span class="n">n_fragment_bases</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">exornase_capacity</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">n_exoRNases</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcat_exoRNase</span> <span class="o">*</span> <span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="n">states</span><span class="p">[</span><span class="s2">&quot;timestep&quot;</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">exornase_capacity</span> <span class="o">&gt;=</span> <span class="n">n_fragment_bases_sum</span><span class="p">:</span>
            <span class="n">update</span><span class="p">[</span><span class="s2">&quot;bulk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nmps_idx</span><span class="p">,</span> <span class="n">n_fragment_bases</span><span class="p">),</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">water_idx</span><span class="p">,</span> <span class="o">-</span><span class="n">n_fragment_bases_sum</span><span class="p">),</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proton_idx</span><span class="p">,</span> <span class="n">n_fragment_bases_sum</span><span class="p">),</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fragment_bases_idx</span><span class="p">,</span> <span class="o">-</span><span class="n">n_fragment_bases</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">total_fragment_bases_digested</span> <span class="o">=</span> <span class="n">n_fragment_bases_sum</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">fragment_specificity</span> <span class="o">=</span> <span class="n">n_fragment_bases</span> <span class="o">/</span> <span class="n">n_fragment_bases_sum</span>
            <span class="n">possible_bases_to_digest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="o">.</span><span class="n">multinomial</span><span class="p">(</span>
                <span class="n">exornase_capacity</span><span class="p">,</span> <span class="n">fragment_specificity</span>
            <span class="p">)</span>
            <span class="n">n_fragment_bases_digested</span> <span class="o">=</span> <span class="n">n_fragment_bases</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span>
                <span class="n">n_fragment_bases</span> <span class="o">-</span> <span class="n">possible_bases_to_digest</span><span class="p">,</span> <span class="mi">0</span>
            <span class="p">)</span>

            <span class="n">total_fragment_bases_digested</span> <span class="o">=</span> <span class="n">n_fragment_bases_digested</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

            <span class="n">update</span><span class="p">[</span><span class="s2">&quot;bulk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nmps_idx</span><span class="p">,</span> <span class="n">n_fragment_bases_digested</span><span class="p">),</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">water_idx</span><span class="p">,</span> <span class="o">-</span><span class="n">total_fragment_bases_digested</span><span class="p">),</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proton_idx</span><span class="p">,</span> <span class="n">total_fragment_bases_digested</span><span class="p">),</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fragment_bases_idx</span><span class="p">,</span> <span class="o">-</span><span class="n">n_fragment_bases_digested</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="n">update</span><span class="p">[</span><span class="s2">&quot;listeners&quot;</span><span class="p">][</span><span class="s2">&quot;rna_degradation_listener&quot;</span><span class="p">][</span><span class="s2">&quot;fragment_bases_digested&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">total_fragment_bases_digested</span>
        <span class="p">)</span>

        <span class="c1"># Note that once mRNAs have been degraded,</span>
        <span class="c1"># chromosome_structure.py will handle deleting the active</span>
        <span class="c1"># ribosomes that were translating those mRNAs.</span>

        <span class="k">return</span> <span class="n">update</span></div>


<div class="viewcode-block" id="RnaDegradation._calculate_total_n_to_degrade">
<a class="viewcode-back" href="../../../reference/api/ecoli/ecoli.processes.rna_degradation.html#ecoli.processes.rna_degradation.RnaDegradation._calculate_total_n_to_degrade">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_total_n_to_degrade</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">specificity</span><span class="p">,</span> <span class="n">total_kcat_endornase</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the total number of RNAs to degrade for a specific class of</span>
<span class="sd">        RNAs, based on the specificity of endoRNases on that specific class and</span>
<span class="sd">        the total kcat value of the endoRNases.</span>

<span class="sd">        Args:</span>
<span class="sd">            specificity: Sum of fraction of active endoRNases for all RNAs</span>
<span class="sd">                in a given class</span>
<span class="sd">            total_kcat_endornase: The summed kcat of all existing endoRNases</span>
<span class="sd">        Returns:</span>
<span class="sd">            Total number of RNAs to degrade for the given class of RNAs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
            <span class="p">(</span><span class="n">specificity</span> <span class="o">*</span> <span class="n">total_kcat_endornase</span> <span class="o">*</span> <span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="n">timestep</span><span class="p">))</span><span class="o">.</span><span class="n">asNumber</span><span class="p">()</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="RnaDegradation._get_rnas_to_degrade">
<a class="viewcode-back" href="../../../reference/api/ecoli/ecoli.processes.rna_degradation.html#ecoli.processes.rna_degradation.RnaDegradation._get_rnas_to_degrade">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_rnas_to_degrade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_total_rnas_to_degrade</span><span class="p">,</span> <span class="n">rna_deg_probs</span><span class="p">,</span> <span class="n">rna_counts</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Distributes the total count of RNAs to degrade for each class of RNAs</span>
<span class="sd">        into individual RNAs, based on the given degradation probabilities</span>
<span class="sd">        of individual RNAs. The upper bound is set by the current count of the</span>
<span class="sd">        specific RNA.</span>

<span class="sd">        Args:</span>
<span class="sd">            n_total_rnas_to_degrade: Total number of RNAs to degrade for the</span>
<span class="sd">                given class of RNAs (integer, scalar)</span>
<span class="sd">            rna_deg_probs: Degradation probabilities of each RNA (vector of</span>
<span class="sd">                equal length to the total number of different RNAs)</span>
<span class="sd">            rna_counts: Current counts of each RNA molecule (vector of equal</span>
<span class="sd">                length to the total number of different RNAs)</span>
<span class="sd">        Returns:</span>
<span class="sd">            Vector of equal length to rna_counts, specifying the number of</span>
<span class="sd">            molecules to degrade for each RNA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_rnas_to_degrade</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">rna_counts</span><span class="p">)</span>
        <span class="n">remaining_rna_counts</span> <span class="o">=</span> <span class="n">rna_counts</span>

        <span class="k">while</span> <span class="p">(</span>
            <span class="n">n_rnas_to_degrade</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">n_total_rnas_to_degrade</span>
            <span class="ow">and</span> <span class="n">remaining_rna_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="n">n_rnas_to_degrade</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="o">.</span><span class="n">multinomial</span><span class="p">(</span>
                    <span class="n">n_total_rnas_to_degrade</span> <span class="o">-</span> <span class="n">n_rnas_to_degrade</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">rna_deg_probs</span>
                <span class="p">),</span>
                <span class="n">remaining_rna_counts</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">remaining_rna_counts</span> <span class="o">=</span> <span class="n">rna_counts</span> <span class="o">-</span> <span class="n">n_rnas_to_degrade</span>

        <span class="k">return</span> <span class="n">n_rnas_to_degrade</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2025, The Vivarium E. coli Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>